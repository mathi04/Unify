{% extends 'base.html' %}
{% block title %}Mon planning{% endblock %}
{% block content %}

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: var(--spacing-lg); gap: var(--spacing-md);">
  <div>
    <h1 style="margin-bottom: 4px;">Planning hebdomadaire</h1>
    <div style="opacity:.8; font-size: var(--font-size-sm);">
      Grille 06:00 → 23:00 · Cours + activités personnelles
    </div>
  </div>

  <a href="{{ url_for('courses.new_activity') }}" class="btn">
    + Ajouter une activité
  </a>
</div>

<div class="card" style="overflow-x:auto;">
  <div style="min-width: 1100px;">

    {# Header: colonne vide (heures) + jours #}
    <div style="display:grid; grid-template-columns: 80px repeat(7, minmax(150px, 1fr)); gap: var(--spacing-sm); align-items:stretch;">
      <div></div>
      {% for day in days %}
        <div style="padding:10px; font-weight:800; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: var(--radius-sm); text-align:center;">
          {{ day }}
        </div>
      {% endfor %}
    </div>

    <div style="height: var(--spacing-sm);"></div>

    {# Corps: colonne des heures + 7 colonnes (days) #}
    <div style="display:grid; grid-template-columns: 80px repeat(7, minmax(150px, 1fr)); gap: var(--spacing-sm); align-items:start;">
      
      {# Colonne heures #}
      <div>
        <div style="height: {{ grid.total_height }}px; position: relative;">
          {% for h in hours %}
            <div style="position:absolute; top: {{ (h - grid.start_hour) * grid.px_per_hour }}px; left:0; right:0; transform: translateY(-8px);
                        font-size: var(--font-size-sm); opacity:.8;">
              {{ "%02d:00"|format(h) }}
            </div>
          {% endfor %}
        </div>
      </div>

      {# Colonnes jours #}
      {% for day in days %}
        <div style="
          height: {{ grid.total_height }}px;
          position: relative;
          border: 1px solid var(--glass-border);
          border-radius: var(--radius-sm);
          background:
            repeating-linear-gradient(
              to bottom,
              rgba(255,255,255,0.06) 0px,
              rgba(255,255,255,0.06) 1px,
              transparent 1px,
              transparent {{ grid.px_per_hour }}px
            );
          overflow: hidden;
        ">

          {# events #}
          {% for item in schedule[day] %}
            <div style="
              position:absolute;
              left: 8px;
              right: 8px;
              top: {{ item.top }}px;
              height: {{ item.height }}px;
              border-radius: 10px;
              padding: 8px;
              background: var(--gradient-accent);
              box-shadow: 0 8px 24px rgba(0,0,0,0.25);
              overflow:hidden;
            ">
              <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
                <div style="min-width:0;">
                  {% if item.kind == "course" %}
                    <div style="font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                      {{ item.code }}
                    </div>
                    <div style="opacity:.95; font-size: var(--font-size-sm); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                      {{ item.title }}
                    </div>
                  {% else %}
                    <div style="font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                      Activité
                    </div>
                    <div style="opacity:.95; font-size: var(--font-size-sm); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                      {{ item.title }}
                    </div>
                  {% endif %}
                </div>

                <div style="font-size: var(--font-size-sm); opacity:.95; white-space:nowrap;">
                  {{ item.start }}–{{ item.end }}
                </div>
              </div>

              {% if item.kind == "course" %}
                <div style="margin-top: 6px;">
                  <a href="{{ url_for('courses.course_detail', course_id=item.id) }}"
                     style="color: rgba(255,255,255,0.95); text-decoration: underline; font-size: var(--font-size-sm);">
                    Détails
                  </a>
                </div>
              {% endif %}
            </div>
          {% endfor %}

        </div>
      {% endfor %}
    </div>

  </div>
</div>

<div style="margin-top:20px;">
  <a href="{{ url_for('courses.my_courses') }}" style="color:var(--color-accent);">Retour</a>
</div>

{% endblock %}
