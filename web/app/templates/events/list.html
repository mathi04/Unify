{% extends 'base.html' %}
{% block title %}Ã‰vÃ©nements{% endblock %}
{% block content %}

<div
    style="display:flex; justify-content:space-between; align-items:center; margin-bottom: var(--spacing-lg); flex-wrap: wrap; gap: var(--spacing-md);">
    <div>
        <h1 style="margin-bottom: 4px;">ğŸ‰ Ã‰vÃ©nements sociaux</h1>
        <div style="opacity:.8; font-size: var(--font-size-sm);">
            Rejoignez ou crÃ©ez des Ã©vÃ©nements (rÃ©visions, sport, soirÃ©es...)
        </div>
    </div>

    {% if current_user.is_authenticated %}
    <a href="{{ url_for('events.new_event') }}" class="btn">
        + CrÃ©er un Ã©vÃ©nement
    </a>
    {% endif %}
</div>

<!-- Filtres et tri -->
<div class="card" style="margin-bottom: var(--spacing-lg);">
    <form method="get" style="display: flex; gap: var(--spacing-md); flex-wrap: wrap; align-items: end;">

        <div style="flex: 1; min-width: 200px;">
            <label
                style="display: block; margin-bottom: 6px; font-size: var(--font-size-sm); font-weight: 600;">CatÃ©gorie</label>
            <select name="category"
                style="width: 100%; padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--glass-border); background: rgba(255,255,255,0.03); color: inherit;">
                <option value="">Toutes les catÃ©gories</option>
                {% for cat in categories %}
                <option value="{{ cat.value }}" {% if current_category==cat.value %}selected{% endif %}>{{ cat.label }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div style="flex: 1; min-width: 200px;">
            <label style="display: block; margin-bottom: 6px; font-size: var(--font-size-sm); font-weight: 600;">Trier
                par</label>
            <select name="sort"
                style="width: 100%; padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--glass-border); background: rgba(255,255,255,0.03); color: inherit;">
                <option value="date" {% if current_sort=='date' %}selected{% endif %}>Date (chronologique)</option>
                <option value="popularity" {% if current_sort=='popularity' %}selected{% endif %}>PopularitÃ©</option>
                <option value="recent" {% if current_sort=='recent' %}selected{% endif %}>RÃ©cents</option>
            </select>
        </div>

        <button type="submit" class="btn" style="background: rgba(100,150,255,0.3);">Filtrer</button>
    </form>
</div>

<!-- Liste des Ã©vÃ©nements -->
{% if events %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: var(--spacing-lg);">
    {% for event in events %}
    <a href="{{ url_for('events.event_detail', event_id=event.id) }}" class="card"
        style="text-decoration: none; color: inherit; transition: all var(--transition-normal); display: flex; flex-direction: column;"
        onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 32px rgba(0,0,0,0.3)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--glass-shadow)';">

        <!-- Header with category -->
        <div
            style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
            <span style="font-size: 2rem;">{{ event.category_emoji }}</span>
            {% if event.is_full %}
            <span
                style="padding: 4px 8px; background: rgba(255,77,109,0.3); border-radius: var(--radius-sm); font-size: var(--font-size-xs); font-weight: 700;">COMPLET</span>
            {% elif event.max_participants and event.participant_count >= event.max_participants * 0.8 %}
            <span
                style="padding: 4px 8px; background: rgba(255,150,0,0.3); border-radius: var(--radius-sm); font-size: var(--font-size-xs); font-weight: 700;">PRESQUE
                COMPLET</span>
            {% endif %}
        </div>

        <!-- Title -->
        <h3 style="color: var(--color-accent); margin-bottom: var(--spacing-xs); font-size: var(--font-size-lg);">{{
            event.title }}</h3>

        <!-- Creator -->
        <div style="font-size: var(--font-size-sm); opacity: 0.7; margin-bottom: var(--spacing-sm);">
            CrÃ©Ã© par {{ event.creator.username }}
        </div>

        <!-- Description -->
        {% if event.description %}
        <p
            style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-md); overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
            {{ event.description }}
        </p>
        {% endif %}

        <!-- Info -->
        <div style="margin-top: auto; padding-top: var(--spacing-md); border-top: 1px solid var(--glass-border);">
            <div style="display: flex; flex-direction: column; gap: 6px; font-size: var(--font-size-sm);">
                <div>ğŸ“… <strong>{{ event.day_of_week }}</strong> Â· {{ event.start_time }} - {{ event.end_time }}</div>
                {% if event.location %}
                <div>ğŸ“ {{ event.location }}</div>
                {% endif %}
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
                    <span>ğŸ‘¥ {{ event.participant_count }}{% if event.max_participants %}/{{ event.max_participants }}{%
                        endif %} participant{{ 's' if event.participant_count != 1 else '' }}</span>
                </div>
            </div>
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="card" style="text-align: center; padding: var(--spacing-xl);">
    <p style="opacity: 0.7;">Aucun Ã©vÃ©nement trouvÃ©. Soyez le premier Ã  en crÃ©er un !</p>
</div>
{% endif %}

{% endblock %}